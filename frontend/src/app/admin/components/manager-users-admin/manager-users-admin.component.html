<div class="user-management">
  <h2>Quản lý Người Dùng</h2>

  <!-- Nút Thêm Người Dùng -->
  <button class="btn-add-user" (click)="toggleAddUserForm()">
    {{ isAdding ? 'Đóng Form Thêm Người Dùng' : 'Thêm Người Dùng' }}
  </button>
  <div class="filter-container">
    <div class="form-group">
      <input
        id="searchName"
        type="text"
        [(ngModel)]="searchCriteria.name"
        placeholder="Tên người dùng"
        class="filter-input"
      />
    </div>
  
    <div class="form-group">
      <input
        id="searchEmail"
        type="text"
        [(ngModel)]="searchCriteria.email"
        placeholder="Email"
        class="filter-input"
      />
    </div>
  
    <div class="form-group">
      <select id="searchRole" [(ngModel)]="searchCriteria.role" class="filter-input">
        <option value="">Tất cả vai trò</option>
        <option value="student">Sinh viên</option>
        <option value="instructor">Giảng viên</option>
      </select>
    </div>
    
    <button (click)="searchUsers()">Tìm kiếm</button>
  </div>
  <!-- Form Thêm Người Dùng -->
  <form class="user-form" *ngIf="isAdding" (ngSubmit)="createUser()">
    <div class="form-group">
      <label for="username">Username</label>
      <input id="username" type="text" [(ngModel)]="newUser.username" name="username" required />
    </div>
    <div class="form-group">
      <label for="fullname">Tên Người Dùng</label>
      <input id="fullname" type="text" [(ngModel)]="newUser.fullname" name="fullname" required />
    </div>
    <div class="form-group">
      <label for="id">Mã số Sinh Viên/Giảng Viên</label>
      <input id="id" type="id" [(ngModel)]="newUser.id" name="id" required />
    </div>
    <div class="form-group">
      <label for="email">Email</label>
      <input id="email" type="email" [(ngModel)]="newUser.email" name="email" required />
    </div>
    <div class="form-group">
      <label for="password">Mật khẩu</label>
      <input id="password" type="password" [(ngModel)]="newUser.password" name="password" required />
    </div>
    <div class="form-group">
      <label for="role">Vai trò</label>
      <select id="role" class="form-control" [(ngModel)]="newUser.role" name="role" required>
        <option value="">-- Chọn vai trò --</option>
        <option value="student">Sinh viên</option>
        <option value="instructor">Giảng viên</option>
      </select>
    </div>
    <div class="form-group">
      <label for="birthdate">Ngày sinh</label>
      <input id="birthdate" type="date" [(ngModel)]="newUser.birthdate" name="birthdate" />
    </div>
    <div class="form-group">
      <label for="phone">Số điện thoại</label>
      <input id="phone" type="text" [(ngModel)]="newUser.phone" name="phone" />
    </div>
    <button type="submit" class="btn-save">Thêm người dùng</button>
    <button type="button" class="btn-reset" (click)="cancelAdd()">Hủy</button>
  </form>

  <!-- Form chỉnh sửa người dùng -->
  <form class="user-form" *ngIf="isEditing" (ngSubmit)="updateUser()">
    <div class="form-group">
      <label for="id">Mã số sinh viên/giảng viên</label>
      <input id="id" type="text" [(ngModel)]="newUser.id" name="id" disabled />
    </div>

    <div class="form-group">
      <label for="userRole">Vai trò</label>
      <input id="userRole" type="text" [value]="getRoleDisplay(newUser.role)" name="role" disabled />
    </div>

    <div class="form-group">
      <label for="userName">Username</label>
      <input id="userName" type="text" [(ngModel)]="newUser.username" name="userName" disabled />
    </div>
    <div class="form-group">
      <label for="name">Tên Người Dùng</label>
      <input id="name" type="text" [(ngModel)]="newUser.fullname" name="name" required />
    </div>

    <div class="form-group">
      <label for="userEmail">Email</label>
      <input id="userEmail" type="email" [(ngModel)]="newUser.email" name="email" required />
    </div>

    <div class="form-group">
      <label for="birthdate">Ngày Sinh</label>
      <input id="birthdate" type="date" [(ngModel)]="newUser.birthdate" name="birthdate" />
    </div>

    <div class="form-group">
      <label for="phone">Số Điện Thoại</label>
      <input id="phone" type="text" [(ngModel)]="newUser.phone" name="phone" />
    </div>

    <button type="submit" class="btn-save">{{ isEditing ? 'Cập Nhật Người Dùng' : '' }}</button>
    <button type="button" class="btn-reset" (click)="resetForm()">Đặt Lại</button>
  </form>

 <!-- Danh sách người dùng -->




 <table class="table">
  <thead>
    <tr>
      <th>Số Thứ Tự</th>
      <th>Tên Người Dùng</th>
      <th>Username</th>
      <th>MSSV/GV</th>
      <th>Vai trò</th>
      <th>Email</th>
      <th>Phê Duyệt</th> <!-- Cột Phê Duyệt -->
      <th>Thao tác</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of filteredUsers; let i = index">
      <td>{{ i + 1 }}</td> <!-- Hiển thị số thứ tự -->
      <td>{{ user.fullname }}</td>
      <td>{{ user.username }}</td>
      <td>{{ user.id }}</td>
      <td>{{ getRoleDisplay(user.role) }}</td>
      <td>{{ user.email }}</td>
      <td>
        <!-- Nút Phê Duyệt chỉ hiển thị nếu người dùng là giảng viên và chưa được phê duyệt -->
        <i *ngIf="user.role === 'instructor' && !user.isApproved" 
           (click)="approveInstructor(user.id, 'approve')" 
           class="fa-regular fa-circle-check"></i>
        
        <!-- Nút Từ Chối chỉ hiển thị nếu người dùng là giảng viên và chưa được phê duyệt -->
        <i *ngIf="user.role === 'instructor' && !user.isApproved" 
           (click)="approveInstructor(user.id, 'reject')" 
           class="fa-regular fa-circle-xmark"></i>
        
        <!-- Hiển thị trạng thái đã phê duyệt -->
        <span *ngIf="user.isApproved" class="approved-status">
          Đã Phê Duyệt
        </span>
        
        <!-- Hiển thị trạng thái đã từ chối -->
        <span *ngIf="user.isRejected" class="rejected-status">
          <i class="fas fa-thumbs-down"></i> Đã Từ Chối
        </span>
      </td>
      <td>
        <button (click)="editUser(user)" type="button" class="btn btn-link btn-primary btn-lg" title="Chỉnh Sửa">
          <i class="fa fa-edit"></i>
        </button>
        <button (click)="deleteUser(user.id, user.role)" type="button" class="btn btn-link btn-danger" title="Xóa">
          <i class="fa fa-times"></i>
        </button>
      </td>
    </tr>
  </tbody>
</table>

  <!-- Điều hướng phân trang -->
<div class="pagination">
  <button 
    (click)="prevPage()" 
    [disabled]="currentPage === 1">
    Trước
  </button>
  <button 
    *ngFor="let page of getPages()" 
    (click)="goToPage(page)" 
    [class.active]="page === currentPage">
    {{ page }}
  </button>
  <button 
    (click)="nextPage()" 
    [disabled]="currentPage === totalPages">
    Tiếp
  </button>
</div>

</div>
