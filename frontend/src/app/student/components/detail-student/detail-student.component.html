<div class="container container-title py-5 mx-0">
  <div class="row" *ngIf="courseDetail">
    <div class="col-md-6">
      <div class="container">
        <div class="row title">
          <p>
            {{ courseDetail.name }}
          </p>
        </div>
        <div class="row instructor">
          <p>
            <span>Giảng viên: </span
            ><span>{{ courseDetail.instructor.fullname }}</span>
          </p>
        </div>
        <div class="row description">
          <p>
            {{ courseDetail.description }}
          </p>
        </div>
        <div class="row controller">
          <div class="col-md-3">
            <button
              class="btn btn-primary register-button"
              *ngIf="isRegistrationCourse; else nonRegister"
              disabled
            >
              Đã đăng ký
            </button>

            <ng-template #nonRegister>
              <button
                class="btn btn-primary register-button"
                (click)="register()"
              >
                Đăng ký
              </button>
            </ng-template>
          </div>
        </div>
        <div
          class="row information min-h-[68px] max-w-[440px] flex flex-wrap gap-2 my-5"
        >
          <div
            class="w-auto h-[30px] py-1 px-3 rounded-[4px] bg-[#19395E] flex gap-2 items-center text-sm"
          >
            <img
              src="../../../../assets/student/img/watch-circle-time.png"
              width="14"
              height="14"
              alt="watch-circle-time"
            />&nbsp;&nbsp;{{ courseDetail.duration }} giờ
          </div>
          <div
            class="w-auto h-[30px] py-1 px-3 rounded-[4px] bg-[#19395E] flex gap-2 items-center text-sm"
          >
            <img
              src="../../../../assets/student/img/bullet-list--points.png"
              width="14"
              height="14"
              alt="bullet-list--points"
            />&nbsp;&nbsp;{{ courseDetail.number_of_lessons }} bài giảng
          </div>
          <div
            class="w-auto h-[30px] py-1 px-3 rounded-[4px] bg-[#19395E] flex gap-2 items-center text-sm"
          >
            <img
              src="../../../../assets/student/img/user-multiple-group.png"
              width="14"
              height="14"
              alt="user-multiple-group"
            />&nbsp;&nbsp;{{ studentRegisterCourse.students.length }} học viên
          </div>
          <div
            class="w-auto h-[30px] py-1 px-3 rounded-[4px] bg-[#19395E] flex gap-2 items-center text-sm"
            *ngIf="courseDetail.certificate"
          >
            <img
              src="../../../../assets/student/img/receipt-check.png"
              width="14"
              height="14"
              alt="receipt-check"
            />&nbsp;&nbsp; Chứng chỉ
          </div>
          <div
            class="w-auto h-[30px] py-1 px-3 rounded-[4px] bg-[#19395E] flex gap-2 items-center text-sm"
          >
            <img
              src="../../../../assets/student/img/star-1.png"
              width="14"
              height="14"
              alt="star-1"
            />&nbsp;&nbsp;{{ courseDetail.rating }} ({{ totalComment }}
            đánh giá)
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2"></div>
    <div class="col-md-4 img-course">
      <img [src]="courseDetail.imageUrl" alt="" />
    </div>
  </div>
</div>

<div class="container">
  <!-- Phần Comments -->
  <div class="row" id="Comments">
    <div class="col-lg-10">
      <!-- Form nhập đánh giá mới -->
      <div class="new-comment">
        <h3>Thêm bình luận của bạn</h3>
        <div class="rating-input">
          <label>Đánh giá:</label>
          <div
            class="stars"
            *ngFor="let star of [1, 2, 3, 4, 5]"
            class="star"
            [class.filled]="star <= rating"
            (click)="setRating(star)"
          >
            <span>&#9733;</span>
          </div>
        </div>
        <div class="comment-form">
          <div class="avatar-input">
            <img [src]="studentLogin.avt" alt="User Avatar" class="avatar" />
          </div>
          <textarea
            id="commentText"
            placeholder="Nhập bình luận của bạn..."
            rows="4"
            class="comment-input"
            [(ngModel)]="newComment"
          ></textarea>

          <button
            id="submitComment"
            class="btn btn-primary"
            (click)="addComment()"
          >
            Gửi bình luận
          </button>
        </div>
      </div>
      <h2>Bình luận của học viên</h2>
      <div *ngIf="visibleComments.length === 0">
        <p>Hiện không có bình luận nào</p>
      </div>
      <div class="comment" *ngFor="let student of visibleComments">
        <div class="comment-header w-100">
          <img [src]="student.avt" alt="Avatar" class="avatar" />
          <strong>{{ student.fullname }}</strong>
          <div class="comment-rating" *ngIf="!isEditing">
            <span
              *ngFor="let star of [1, 2, 3, 4, 5]"
              [class.filled]="star <= student.reviews[0].rating"
              class="star"
            >
              &#9733;
              <!-- Sao đầy -->
            </span>
          </div>
          <div class="rating-input" *ngIf="isEditing">
            <div
              class="stars"
              *ngFor="let star of [1, 2, 3, 4, 5]"
              class="star"
              [class.filled]="star <= updateRatingNumber"
              (click)="setRating(star)"
            >
              <span>&#9733;</span>
            </div>
          </div>
          <div
            class="comment-interact d-flex justify-content-end"
            *ngIf="student.id === studentLogin.id"
          >
            <button
              class="btn btn-primary btn-sm me-2"
              (click)="getMySentimentAnalyze()"
              title="Xem kết quả phân tích cảm xúc"
            >
              <i class="bi bi-eye"></i>
            </button>
            <button
              class="btn btn-primary btn-sm me-2"
              title="Chỉnh sửa bình luận"
              (click)="enableEditMode()"
            >
              <i class="bi bi-pencil"></i>
            </button>
            <button
              class="btn btn-danger btn-sm"
              (click)="deleteComment()"
              title="Xóa bình luận"
            >
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
        <div *ngIf="!isEditing">
          <div *ngFor="let review of student.reviews">
            <p>{{ review.comment }}</p>
          </div>
        </div>

        <div
          class="update-comment-container"
          *ngIf="isEditing && student.id === studentLogin.id"
        >
          <textarea
            class="w-100"
            [(ngModel)]="updateCommentText"
            placeholder="Nhập bình luận mới ..."
            rows="10"
            >{{ updateCommentText }}</textarea
          >
          <div class="d-flex justify-content-end">
            <button class="btn btn-primary me-2" (click)="updateComment()">
              Lưu
            </button>
            <button class="btn btn-secondary" (click)="enableEditMode()">
              Hủy
            </button>
          </div>
        </div>
      </div>

      <!-- Nút xem thêm nếu còn bình luận để load -->
      <button
        *ngIf="visibleComments.length < comments.length"
        (click)="loadMoreComments()"
        class="btn btn-secondary"
      >
        Xem thêm
      </button>
    </div>
  </div>
</div>
